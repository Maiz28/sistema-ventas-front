import{a as je}from"./chunk-4GGSD53W.js";import{a as H}from"./chunk-FGYYGVG3.js";import{A as be,B as Ee,F as De,G as xe,H as Se,I as we,J as Me,K as Ie,L as Ue,M as ye,N as Te,O as Fe,P as Re,Q as ke,R as F,S as R,T as k,U as Ne,V as Oe,W as N,X as O,Y as A,Z as Ae,a as se,b as x,e as me,f as le,k as ce,l as f,m as de,n as ue,o as pe,p as fe,q as he,r as ge,s as Ce,x as _e,y as ve}from"./chunk-C43BA76M.js";import{a as ae,m as G}from"./chunk-MFKGNWZG.js";import"./chunk-IX6G3U3V.js";import{$b as re,Bb as J,Cb as K,Db as o,E as _,Eb as n,Fb as p,Gb as b,Hb as E,Jb as X,Mb as C,Mc as oe,Ob as D,Pc as ne,Sb as Z,Tb as ee,Ub as te,W as U,Wb as a,Xb as ie,Yb as c,Za as m,_a as u,aa as Q,ba as y,c as P,fa as L,j as I,ka as v,la as T,q as z,rb as g,ta as B,tb as h,ua as q,zb as Y}from"./chunk-M7QQO3YR.js";var j=(()=>{let t=class t{constructor(r,i){this.http=r,this.snackBar=i,this.API_URL=`${H.API_URL}/user`}getUsers(){return this.http.get(`${this.API_URL}/getUsers`,{headers:{requireToken:"true"}}).pipe(_(r=>this.handlerError(r)))}newUser(r){return this.http.post(`${this.API_URL}/newUser`,r,{headers:{requireToken:"true"}}).pipe(_(i=>this.handlerError(i)))}updateUser(r){return this.http.put(`${this.API_URL}/updateUser`,r,{headers:{requireToken:"true"}}).pipe(_(i=>this.handlerError(i)))}deleteUser(r){return this.http.post(`${this.API_URL}/deleteUser`,r,{headers:{requireToken:"true"}}).pipe(_(i=>this.handlerError(i)))}handlerError(r){var i="Ocurri\xF3 un error";return r.error&&(r.error.message?i=r.error.message:i="Ocurri\xF3 un error"),this.snackBar.open(i,"",{duration:3e3}),z(()=>{new Error(i)})}getRoles(){return this.http.get(`${H.API_URL}/rol/getRol`,{headers:{requireToken:"true"}}).pipe(_(r=>this.handlerError(r)))}};t.\u0275fac=function(i){return new(i||t)(L(ae),L(me))},t.\u0275prov=Q({token:t,factory:t.\u0275fac,providedIn:"root"});let e=t;return e})();function He(e,t){if(e&1&&(o(0,"mat-option",7),a(1),n()),e&2){let l=t.$implicit;h("value",l.cverol),m(),c("",l.descripcion+" - "+l.clave," ")}}function We(e,t){if(e&1&&(o(0,"mat-form-field",2)(1,"mat-label"),a(2,"Contrase\xF1a"),n(),p(3,"input",14),o(4,"mat-error"),a(5),n()()),e&2){let l=D();m(5),c(" ",l.baseForm.getErrorMessage(l.userForm.get("password"))," ")}}function ze(e,t){if(e&1&&(o(0,"mat-form-field",2)(1,"mat-label"),a(2,"Confirmar Contrase\xF1a"),n(),p(3,"input",15),o(4,"mat-error"),a(5),n()()),e&2){let l=D();m(5),c(" ",l.baseForm.getErrorMessage(l.userForm.get("confirmPassword"))," ")}}var M=function(e){return e.EDIT="edit",e.NEW="new",e}(M||{}),Le=(()=>{let t=class t{constructor(r,i,s,d,$){this.data=r,this.fb=i,this.userService=s,this.baseForm=d,this.dialogRef=$,this.destroy$=new I,this.titleButton="Guardar",this.actionTODO=M.NEW,this.roles=[],this.userForm=this.fb.group({cveusuario:[""],nombre:["",[f.required,f.minLength(3)]],apellidos:["",[f.required,f.minLength(3)]],username:["",[f.required,f.email]],rol:["",[f.required]],password:["",[f.required,f.minLength(8)]],confirmPassword:["",[f.required]]})}ngOnInit(){this.pathData(),this.userService.getRoles().pipe(U(this.destroy$)).subscribe(r=>{this.roles=r,this.pathData()})}pathData(){this.data.user.cveusuario?(this.titleButton="Actualizar",this.actionTODO=M.EDIT,this.userForm.patchValue({cveusuario:this.data.user.cveusuario,nombre:this.data.user.nombre,apellidos:this.data.user.apellidos,username:this.data.user.username,rol:this.data.user.rol.cverol}),this.userForm.get("username")?.disable(),this.userForm.get("password")?.setValidators(null),this.userForm.get("password")?.setErrors(null),this.userForm.get("confirmPassword")?.setValidators(null),this.userForm.get("confirmPassword")?.setErrors(null),this.userForm.updateValueAndValidity()):(this.titleButton="Guardar",this.actionTODO=M.NEW)}onSave(){if(this.userForm.invalid)return;let r=this.userForm.getRawValue();if(this.actionTODO===M.NEW){let i=r,{confirmPassword:d,cveusuario:$}=i,W=P(i,["confirmPassword","cveusuario"]);this.userService.newUser(W).subscribe(S=>{this.dialogRef.close(S)},S=>{})}else{let s=r,{confirmPassword:d,password:$,username:W}=s,S=P(s,["confirmPassword","password","username"]);console.log(S),this.userService.updateUser(S).subscribe(V=>{this.dialogRef.close(V)},V=>{console.error(V)})}}ngOnDestroy(){this.destroy$.next({}),this.destroy$.complete()}};t.\u0275fac=function(i){return new(i||t)(u(k),u(ge),u(j),u(je),u(R))},t.\u0275cmp=v({type:t,selectors:[["app-usuarios-dialog"]],decls:40,vars:8,consts:[["mat-dialog-title",""],[3,"submit","formGroup"],["appearance","outline",1,"full-width"],["type","text","formControlName","nombre","matInput",""],["type","text","formControlName","apellidos","matInput",""],["type","text","formControlName","username","matInput",""],["formControlName","rol"],[3,"value"],["class","full-width","appearance","outline",4,"ngIf"],["align","center"],["tuye","button","mat-flat-button","","color","warn",1,"me-2"],["mat-flat-button","","color","primary","type","submit"],["align","end"],["mat-button","","mat-dialog-close",""],["type","password","formControlName","password","matInput",""],["type","password","formControlName","confirmPassword","matInput",""]],template:function(i,s){i&1&&(o(0,"h1",0),a(1,"Usuario"),n(),o(2,"mat-dialog-content")(3,"form",1),C("submit",function(){return s.onSave()}),o(4,"mat-form-field",2)(5,"mat-label"),a(6,"Nombre"),n(),p(7,"input",3),o(8,"mat-error"),a(9),n()(),o(10,"mat-form-field",2)(11,"mat-label"),a(12,"Apellidos"),n(),p(13,"input",4),o(14,"mat-error"),a(15),n()(),o(16,"mat-form-field",2)(17,"mat-label"),a(18,"Nombre de Usuario"),n(),p(19,"input",5),o(20,"mat-error"),a(21),n()(),o(22,"mat-form-field",2)(23,"mat-label"),a(24,"Rol"),n(),o(25,"mat-select",6),J(26,He,2,2,"mat-option",7,Y),n(),o(28,"mat-error"),a(29),n()(),g(30,We,6,1,"mat-form-field",8)(31,ze,6,1,"mat-form-field",8),o(32,"div",9)(33,"button",10),a(34,`
Limpiar `),n(),o(35,"button",11),a(36),n()()()(),o(37,"mat-dialog-actions",12)(38,"button",13),a(39,"Cerrar"),n()()),i&2&&(m(3),h("formGroup",s.userForm),m(6),c(" ",s.baseForm.getErrorMessage(s.userForm.get("nombre"))," "),m(6),c(" ",s.baseForm.getErrorMessage(s.userForm.get("apellidos"))," "),m(6),c(" ",s.baseForm.getErrorMessage(s.userForm.get("username"))," "),m(5),K(s.roles),m(3),c(" ",s.baseForm.getErrorMessage(s.userForm.get("rol"))," "),m(),h("ngIf",s.actionTODO=="new"),m(),h("ngIf",s.actionTODO=="new"),m(5),c(" ",s.titleButton," "))},dependencies:[oe,x,Ee,be,_e,ve,Oe,N,A,O,ke,se,pe,ce,de,ue,fe,he]});let e=t;return e})();var Be=(()=>{let t=class t{constructor(r,i){this.dialogRef=r,this.data=i}onNoClick(){this.dialogRef.close(!1)}onYesClick(){this.dialogRef.close(!0)}};t.\u0275fac=function(i){return new(i||t)(u(R),u(k))},t.\u0275cmp=v({type:t,selectors:[["app-delete-dialog"]],decls:10,vars:1,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"click"],["mat-button","","color","warn",3,"click"]],template:function(i,s){i&1&&(o(0,"h1",0),a(1,"Confirmar"),n(),o(2,"div",1)(3,"p"),a(4),n()(),o(5,"div",2)(6,"button",3),C("click",function(){return s.onNoClick()}),a(7,"Cancelar"),n(),o(8,"button",4),C("click",function(){return s.onYesClick()}),a(9,"Eliminar"),n()()),i&2&&(m(4),ie(s.data.message))},dependencies:[x,N,A,O]});let e=t;return e})();var Qe=()=>[5,10,20,100];function Ye(e,t){e&1&&(o(0,"th",16),a(1,"Nombre"),n())}function Je(e,t){if(e&1&&(o(0,"td",17),a(1),n()),e&2){let l=t.$implicit;m(),c("",l.nombre," ")}}function Ke(e,t){e&1&&(o(0,"th",16),a(1,"Apellido"),n())}function Xe(e,t){if(e&1&&(o(0,"td",17),a(1),n()),e&2){let l=t.$implicit;m(),c("",l.apellidos," ")}}function Ze(e,t){e&1&&(o(0,"th",16),a(1,"Nombre del usuario"),n())}function et(e,t){if(e&1&&(o(0,"td",17),a(1),n()),e&2){let l=t.$implicit;m(),c("",l.username," ")}}function tt(e,t){e&1&&(o(0,"th",16),a(1,"Rol(es)"),n())}function it(e,t){if(e&1&&(o(0,"td",17),a(1),n()),e&2){let l=t.$implicit;m(),c("",l.rol.descripcion," ")}}function rt(e,t){e&1&&p(0,"th",16)}function ot(e,t){if(e&1){let l=X();o(0,"td",18)(1,"button",19),C("click",function(){let i=B(l).$implicit,s=D();return q(s.onOpenModal(i))}),o(2,"mat-icon"),a(3,"edit"),n(),a(4,"Editar"),n(),o(5,"button",20),C("click",function(){let i=B(l).$implicit,s=D();return q(s.confirmDelete(i.cveusuario,i.username))}),o(6,"mat-icon"),a(7,"delete"),n(),a(8,"Eliminar "),n()()}}function nt(e,t){e&1&&p(0,"tr",21)}function at(e,t){e&1&&p(0,"tr",22)}var qe=(()=>{let t=class t{constructor(r,i){this.dialog=r,this.userService=i,this.destroy$=new I,this.dataSource=new Re,this.displayedColumns=["nombre","apellido","username","rol","acciones"],this.usuario=[]}ngOnInit(){this.getUsers()}ngAfterViewInit(){this.dataSource.paginator=this.paginator}onOpenModal(r={}){this.dialog.open(Le,{maxWidth:"100%",data:{user:r}}).afterClosed().pipe(U(this.destroy$)).subscribe(s=>{s&&this.getUsers()})}ngOnDestroy(){}getUsers(){this.userService.getUsers().subscribe(r=>{this.dataSource.data=r})}confirmDelete(r,i){this.dialog.open(Be,{width:"300px",data:{message:`\xBFEst\xE1 seguro de que desea eliminar el usuario ${i}?`}}).afterClosed().subscribe(d=>{d&&this.deleteUser(r)})}deleteUser(r){let i={cveusuario:r};this.userService.deleteUser(i).subscribe(s=>{this.getUsers()})}};t.\u0275fac=function(i){return new(i||t)(u(Ne),u(j))},t.\u0275cmp=v({type:t,selectors:[["app-usuarios"]],viewQuery:function(i,s){if(i&1&&Z(F,5),i&2){let d;ee(d=te())&&(s.paginator=d.first)}},decls:27,vars:5,consts:[[2,"margin","12px"],["align","right"],["mat-flat-button","","color","primary",3,"click"],["m-4","",1,"table-content","mat-elevation-z8"],["mat-table","",3,"dataSource"],["matColumnDef","nombre"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","apellido"],["matColumnDef","username"],["matColumnDef","rol"],["matColumnDef","acciones"],["mat-cell","","class","text-center",4,"matCellDef"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirsLastButtons","",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],["mat-cell","",1,"text-center"],["mat-flat-button","","color","accent",1,"me-2",3,"click"],["mat-flat-button","","color","warn",3,"click"],["mat-header-row",""],["mat-row",""]],template:function(i,s){i&1&&(o(0,"h1",0),a(1," Usuarios "),n(),o(2,"div",1)(3,"button",2),C("click",function(){return s.onOpenModal()}),o(4,"mat-icon"),a(5,"add"),n(),a(6," agregar "),n()(),o(7,"div",3)(8,"table",4),b(9,5),g(10,Ye,2,0,"th",6)(11,Je,2,1,"td",7),E(),b(12,8),g(13,Ke,2,0,"th",6)(14,Xe,2,1,"td",7),E(),b(15,9),g(16,Ze,2,0,"th",6)(17,et,2,1,"td",7),E(),b(18,10),g(19,tt,2,0,"th",6)(20,it,2,1,"td",7),E(),b(21,11),g(22,rt,1,0,"th",6)(23,ot,9,0,"td",12),E(),g(24,nt,1,0,"tr",13)(25,at,1,0,"tr",14),n(),p(26,"mat-paginator",15),n()),i&2&&(m(8),h("dataSource",s.dataSource),m(16),h("matHeaderRowDef",s.displayedColumns),m(),h("matRowDefColumns",s.displayedColumns),m(),h("pageSizeOptions",re(4,Qe)))},dependencies:[x,le,De,Se,Ue,we,xe,ye,Me,Ie,Te,Fe,F]});let e=t;return e})();var st=[{path:"",component:qe}],Ge=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=T({type:t}),t.\u0275inj=y({imports:[G.forChild(st),G]});let e=t;return e})();var Qt=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=T({type:t}),t.\u0275inj=y({imports:[ne,Ge,Ae,Ce]});let e=t;return e})();export{Qt as UsuariosModule};
